id: xyz.fontra.FontraPak
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '6.9'
command: fontrapak

build-options:
  build-args:
    - --share=network

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --share=network
  - --filesystem=xdg-documents
  - --filesystem=xdg-download

modules:
  # Git dependencies for Fontra packages
  - name: fontra-git-dependencies
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/fontra/fontra.git
        commit: cd7497532ac1ee67b565f90e74c09f9ea5d51f5e
        dest: fontra
      - type: git
        url: https://github.com/fontra/fontra-compile.git
        commit: 7177006eae1bbd7ddcb435e3ff1c8c258ecc27f0
        dest: fontra-compile
      - type: git
        url: https://github.com/fontra/fontra-rcjk.git
        commit: 368f50050fe6cfbdfb46d37bb6bb0a58cba012ea
        dest: fontra-rcjk
      - type: git
        url: https://github.com/fontra/fontra-glyphs.git
        commit: 621bb929242fe45937000cc21670337cd824b5eb
        dest: fontra-glyphs
      - type: git
        url: https://github.com/justvanrossum/delocate.git
        commit: 84dbca9fd5c4feedd418e21a31ed4e9b581dff86
        dest: delocate
    build-commands:
      - pip3 install --verbose --prefix=${FLATPAK_DEST} --no-deps ./fontra
      - pip3 install --verbose --prefix=${FLATPAK_DEST} --no-deps ./fontra-compile
      - pip3 install --verbose --prefix=${FLATPAK_DEST} --no-deps ./fontra-rcjk
      - pip3 install --verbose --prefix=${FLATPAK_DEST} --no-deps ./fontra-glyphs
      - pip3 install --verbose --prefix=${FLATPAK_DEST} --no-deps ./delocate

  # PyPI dependencies generated by flatpak-pip-generator
  - pypi-dependencies.json

  # Main FontraPak application
  - name: fontrapak
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/fontra/fontra-pak.git
        tag: 2025.12.2
        commit: 64f3a3c56312b6281b32d2fa43e12cf0b417243c
      - type: file
        path: data/icons/xyz.fontra.FontraPak.svg
        dest-filename: xyz.fontra.FontraPak.svg
      - type: file
        path: xyz.fontra.FontraPak.desktop
        dest-filename: xyz.fontra.FontraPak.desktop
      - type: file
        path: xyz.fontra.FontraPak.metainfo.xml
        dest-filename: xyz.fontra.FontraPak.metainfo.xml
    build-commands:
      # Build with PyInstaller
      - pyinstaller --onefile --name fontrapak FontraPakMain.py
      # Install the built binary
      - install -Dm755 dist/fontrapak ${FLATPAK_DEST}/bin/fontrapak
      # Install icon, desktop file and metainfo
      - install -Dm644 xyz.fontra.FontraPak.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/xyz.fontra.FontraPak.svg
      - install -Dm644 xyz.fontra.FontraPak.desktop ${FLATPAK_DEST}/share/applications/xyz.fontra.FontraPak.desktop
      - install -Dm644 xyz.fontra.FontraPak.metainfo.xml ${FLATPAK_DEST}/share/metainfo/xyz.fontra.FontraPak.metainfo.xml
